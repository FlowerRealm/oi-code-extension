name: 调试 - PR评论触发

on:
  issue_comment:
    types: [created]

jobs:
  debug-comment:
    if: ${{ github.event_name == 'issue_comment' && github.event.issue.pull_request }}
    runs-on: ubuntu-latest
    steps:
      - name: 📝 调试PR评论信息
        run: |
          echo "🔍 PR 评论调试信息"
          echo "===================="
          echo "评论内容: ${{ github.event.comment.body }}"
          echo "评论ID: ${{ github.event.comment.id }}"
          echo "评论用户: ${{ github.event.comment.user.login }}"
          echo "Issue/PR 号码: ${{ github.event.issue.number }}"
          echo "是否为PR: ${{ github.event.issue.pull_request != null }}"
          echo "事件名称: ${{ github.event_name }}"
          echo "事件操作: ${{ github.event.comment.action || 'N/A' }}"

          COMMENT="${{ github.event.comment.body }}"
          echo ""
          echo "📋 分析评论内容..."
          echo "原始评论: '$COMMENT'"

          if echo "$COMMENT" | grep -q '\bdocker-push\b'; then
            echo "✅ 检测到 'docker-push' 关键词"
            echo "🚀 评论匹配成功，会触发Docker构建"
          else
            echo "❌ 未检测到 'docker-push' 关键词"
            echo "ℹ️  请在评论中使用 'docker-push' 来触发Docker构建"
          fi

          # 显示所有关键词匹配
          echo ""
          echo "🔍 检查所有关键词:"
          if echo "$COMMENT" | grep -q 'docker-push'; then echo "✅ docker-push found"; else echo "❌ docker-push not found"; fi
          if echo "$COMMENT" | grep -q '\blinux\b'; then echo "✅ linux found - 默认平台"; else echo "ℹ️ linux not found - 使用默认Linux"; fi
          if echo "$COMMENT" | grep -q '\bwindows\b'; then echo "✅ windows found - Windows平台"; fi
          if echo "$COMMENT" | grep -q '\ball\b'; then echo "✅ all found - 全平台"; fi

          echo ""
          echo "💡 使用示例:"
          echo "  - docker-push              (Linux平台)"
          echo "  - docker-push linux        (Linux平台)"
          echo "  - docker-push windows      (Windows平台)"
          echo "  - docker-push all          (全平台)"

      - name: 🎯 模拟触发Docker构建
        if: ${{ contains(github.event.comment.body, 'docker-push') }}
        run: |
          echo "🎯 Docker构建模拟触发成功!"
          echo "📝 这是调试模式，实际Docker构建工作流应该会被触发"
          echo ""
          echo "🔍 如果实际工作流没有触发，请检查:"
          echo "1. 工作流文件是否存在: .github/workflows/docker-build.yml"
          echo "2. Docker Hub Token 是否正确配置: secrets.DOCKER_HUB_TOKEN"
          echo "3. 分支是否有权限执行生产环境job"
          echo ""
          echo "📋 当前环境信息:"
          echo "- Repository: ${{ github.repository }}"
          echo "- Branch: ${{ github.ref }}"
          echo "- SHA: ${{ github.sha }}"
