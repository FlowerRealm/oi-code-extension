## OI-Code Clang Docker Images è‡ªåŠ¨åŒ–æ–‡æ¡£

æœ¬ç›®å½•åŒ…å« OI-Code æ‰©å±•çš„ Docker Clang é•œåƒè‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒé…ç½®ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

OI-Code ç°åœ¨è‡ªåŠ¨ä½¿ç”¨åŸºäº **Ubuntu 24.04 + Clang 18.1.8** çš„é•œåƒï¼Œæä¾›ï¼š

1. **å…¨è‡ªåŠ¨åŒ–æ„å»º**: GitHub Actions è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ
2. **ç»Ÿä¸€çš„ Clang å·¥å…·é“¾**: æ›¿æ¢åŸæœ‰çš„ GCCï¼Œç¡®ä¿ä¸€è‡´æ€§å’Œæ€§èƒ½
3. **è·¨å¹³å°å…¼å®¹**: åŸºäº Ubuntu 24.04ï¼Œæ”¯æŒ Linux/macOS/Windows through Docker Desktop
4. **æ„å»ºç¼“å­˜ä¼˜åŒ–**: ä½¿ç”¨ Docker æ„å»ºç¼“å­˜åŠ é€Ÿ CI/CD æµç¨‹
5. **å®‰å…¨è®¤è¯**: ä½¿ç”¨ Docker Hub ä¸ªäººè®¿é—®ä»¤ç‰Œè€Œéå¯†ç 

### ğŸš€ è‡ªåŠ¨åŒ–æµç¨‹

#### âš¡ GitHub Actions è‡ªåŠ¨å·¥ä½œæµ

å½“æ‚¨æ¨é€ä»£ç åˆ° `main` åˆ†æ”¯æ—¶ï¼š

1. **è‡ªåŠ¨æµ‹è¯•**: 14ç§æ“ä½œç³»ç»ŸçŸ©é˜µæµ‹è¯•
2. **æ„å»ºé•œåƒ**: Ubuntu 24.04 + Clang 18 å·¥å…·é“¾
3. **æ¨é€åˆ° Docker Hub**: ç”Ÿæˆä¸¤ä¸ªæ ‡ç­¾
4. **æ„å»ºç¼“å­˜å‚¨å­˜**: åŠ å¿«åç»­æ„å»ºé€Ÿåº¦

#### ğŸ“¦ è‡ªåŠ¨ç”Ÿæˆçš„é•œåƒæ ‡ç­¾

```bash
ğŸ³ flowerrealm/oi-code-clang:latest     # æœ€æ–°ç‰ˆ
ğŸ³ flowerrealm/oi-code-clang:v{x.y.z}   # ç‰ˆæœ¬æ ‡ç­¾
ğŸ”§ flowerrealm/oi-code-clang:buildcache # æ„å»ºç¼“å­˜
```

### ğŸ“‹ ä½¿ç”¨æ–¹æ³•

#### ğŸŒ ä» Docker Hub æ‹‰å–

```bash
# æ‹‰å–æœ€æ–°ç‰ˆ
docker pull flowerrealm/oi-code-clang:latest

# éªŒè¯ Clang å®‰è£…
docker run --rm flowerrealm/oi-code-clang:latest clang++ --version
```

#### âš™ï¸ OI-Code æ‰©å±•è‡ªåŠ¨ä½¿ç”¨

å®‰è£…é•œåƒåï¼ŒOI-Code æ‰©å±•ä¼šè‡ªåŠ¨ä½¿ç”¨ï¼Œ**æ— éœ€æ‰‹åŠ¨é…ç½®**ï¼š

```json
// settings.json (è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€ä¿®æ”¹)
{
  "oicode.docker.compilers": {
    "cpp": "flowerrealm/oi-code-clang:latest",
    "c": "flowerrealm/oi-code-clang:latest"
  }
}
```

#### ğŸ§ª æœ¬åœ°æµ‹è¯•

```bash
# åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
echo '#include <bits/stdc++.h>
int main() {
    std::cout << "Hello OI-Clang!" << std::endl;
    return 0;
}' > test.cpp

# ç¼–è¯‘è¿è¡Œ
docker run --rm \
  -v $(pwd):/workspace \
  -w /workspace \
  flowerrealm/oi-code-clang:latest \
  clang++ test.cpp -o test && ./test
```

#### ğŸŒ è¿›å…¥å®¹å™¨è°ƒè¯•

```bash
# Linux/macOS
docker run -it --rm flowerrealm/oi-code-clang:latest /bin/bash
docker run -it --rm flowerrealm/oi-code-clang:arm64 /bin/bash

# å¯ç”¨çš„å·¥å…·ï¼š
# clang, clang++, lldb, llvm, lld, valgrind
# gdb-multiarch (ARM64 only), gcc-arm-linux-gnueabihf (ARM64 only)
```

#### ğŸš€ è‡ªåŠ¨åŒ–æ„å»ºå’Œæ¨é€

```bash
# ä¸€é”®æ„å»ºå¤šå¹³å°é•œåƒ
docker buildx build --platform linux/amd64,linux/arm64 -t flowerrealm/oi-code-clang:latest --push .

# åˆ†æ­¥æ„å»º
# 1. åˆ›å»ºbuilder
docker buildx create --use --name multiarch-builder

# 2. æ„å»ºå’Œæ¨é€AMD64ç‰ˆæœ¬
docker buildx build --platform linux/amd64 -t flowerrealm/oi-code-clang:amd64 --push .

# 3. æ„å»ºå’Œæ¨é€ARM64ç‰ˆæœ¬
docker buildx build --platform linux/arm64 -t flowerrealm/oi-code-clang:arm64 --push .

# 4. åˆ›å»ºå¤šæ¶æ„manifest
docker buildx build --platform linux/amd64,linux/arm64 -t flowerrealm/oi-code-clang:latest --push .
```

#### ğŸ³ é•œåƒç®¡ç†

```bash
# æŸ¥çœ‹æ”¯æŒçš„å¹³å°
docker buildx imagetools inspect flowerrealm/oi-code-clang:latest

# åˆ é™¤æœ¬åœ°é•œåƒ
docker rmi flowerrealm/oi-code-clang:latest

# æŸ¥çœ‹é•œåƒå†å²
docker history flowerrealm/oi-code-clang:latest

# æ¨é€åˆ°å…¶ä»–ä»“åº“
docker tag flowerrealm/oi-code-clang:latest my-registry/oi-code-clang:latest
docker push my-registry/oi-code-clang:latest
```

### ğŸ”§ æŠ€æœ¯æ¶æ„

#### ğŸ³ Dockerfile ç®€ä»‹

```dockerfile
FROM ubuntu:24.04
ENV DEBIAN_FRONTEND=noninteractive

# å®‰è£… Clang 18 æ ¸å¿ƒå·¥å…·é“¾ï¼ˆç«æŠ€ç¼–ç¨‹ä¼˜åŒ–ï¼‰
RUN apt-get update --quiet && \
    apt-get install -y --no-install-recommends \
        clang-18 \
        clang++-18 \
        libc6-dev \
        libc++-18-dev \
        libc++abi-18-dev \
        libstdc++-13-dev \
        libboost-dev \
        libgmp-dev \
        libmpfr-dev \
        && \
    # åˆ›å»ºç¬¦å·é“¾æ¥
    ln -sf /usr/bin/clang-18 /usr/bin/clang && \
    ln -sf /usr/bin/clang++-18 /usr/bin/clang++ && \
    # åˆ›å»ºè¿è¡Œç”¨æˆ·
    useradd -m -s /bin/bash runner && \
    mkdir -p /sandbox && \
    chown -R runner:runner /sandbox && \
    # æ¸…ç†ç¼“å­˜
    apt-get autoremove -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# éªŒè¯å®‰è£…
RUN clang --version && clang++ --version
```

#### ğŸ› ï¸ é¢„è£…å·¥å…·

**Clang ç³»åˆ—**:
- `clang` / `clang++` - C/C++ ç¼–è¯‘å™¨
- `lldb` - è°ƒè¯•å™¨
- `lld` - é«˜æ€§èƒ½é“¾æ¥å™¨
- `llvm-ar` / `llvm-nm` - å·¥å…·é“¾ç»„ä»¶

**ä¼ ç»Ÿå·¥å…·**:
- `valgrind` - å†…å­˜æ£€æµ‹å·¥å…·

#### âš¡ æ€§èƒ½ä¼˜åŒ–

- **æœ€å°åŒ–é•œåƒ**: åŸºäº Ubuntu 24.04ï¼Œå»é™¤äº†ä¸å¿…è¦çš„åŒ…
- **æ„å»ºç¼“å­˜**: å¤šå±‚ç¼“å­˜ä¼˜åŒ–ï¼Œæ˜¾è‘—æé€Ÿ CI/CD
- **ç½‘ç»œä¼˜åŒ–**: ä½¿ç”¨å®˜æ–¹ Ubuntu æºç¡®ä¿æœ€å¤§å…¼å®¹æ€§
- **å®‰å…¨é…ç½®**: érootç”¨æˆ·è¿è¡Œï¼Œéš”ç¦»æ–‡ä»¶ç³»ç»Ÿ

### ğŸ” å®‰å…¨é…ç½®

#### ğŸ·ï¸ é•œåƒå®‰å…¨ç‰¹æ€§

- âœ… **æœ€å°åŒ–æ”»å‡»é¢**: åªåŒ…å«å¿…è¦çš„ç¼–è¯‘å·¥å…·
- âœ… **ç½‘ç»œéš”ç¦»**: å®¹å™¨å†…ç½‘ç»œè®¿é—®å—é™
- âœ… **æ–‡ä»¶éš”ç¦»**: æºä»£ç ç‹¬ç«‹æŒ‚è½½ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
- âœ… **æƒé™æ§åˆ¶**: érootç”¨æˆ·è¿è¡Œåº”ç”¨

#### ğŸ”‘ Docker Hub è®¤è¯

ä½¿ç”¨ä¸ªäººè®¿é—®ä»¤ç‰Œè€Œéå¯†ç ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DOCKERHUB_TOKEN="your-token-here"

# æˆ–ä½¿ç”¨å‘å¸ƒè„šæœ¬ (è‡ªåŠ¨å¤„ç†ä»¤ç‰Œè®¤è¯)
./push-to-dockerhub.sh --all
```

### ğŸ“Š CI/CD é›†æˆ

#### ğŸš€ GitHub Actions å·¥ä½œæµ

`.github/workflows/ci.yml` æä¾›äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼š

```yaml
# ä¸»è¦ä½œä¸š
- test:          # 14ç§å¹³å°çŸ©é˜µæµ‹è¯•
- deploy-docker: # è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒé•œåƒ

# è§¦å‘æ¡ä»¶
- push to main + manual deployment
- è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬æ ‡ç­¾
- æ„å»ºç¼“å­˜ç®¡ç†
```

#### ğŸ§ª æœ¬åœ°å¼€å‘

å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨å‘å¸ƒè„šæœ¬ï¼š

```bash
# æ„å»ºå¹¶æ¨é€æ‰€æœ‰ç‰ˆæœ¬
./push-to-dockerhub.sh --all

# æ„å»ºä½†ä¸æ¨é€ (æµ‹è¯•)
./push-to-dockerhub.sh --build-only

# æ¨é€ç‰¹å®šç‰ˆæœ¬
./push-to-dockerhub.sh --version v1.2.3
```

### ğŸµ æ•…éšœæ’é™¤

#### ğŸš¨ é•œåƒæ‹‰å–å¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜å¹¶é‡è¯•
docker system prune -a
docker pull flowerrealm/oi-code-clang:latest

# æ•…éšœæ’é™¤
docker logs <container_id>
```

#### ğŸ› ç¼–è¯‘é”™è¯¯

```bash
# æ£€æŸ¥ Clang ç‰ˆæœ¬
docker run --rm flowerrealm/oi-code-clang:latest clang++ --version

# ä½¿ç”¨ç‰¹å®šæ ‡å‡†
clang++ main.cpp -std=c++17 -o main

# å¯ç”¨è°ƒè¯•ä¿¡æ¯
clang++ main.cpp -g -O0 -o main
```

#### ğŸ–¥ï¸ Windows å…¼å®¹é—®é¢˜

å¯¹äº Windows ç”¨æˆ·ï¼Œæ¨èä½¿ç”¨ Docker Desktop çš„ Linux å®¹å™¨æ¨¡å¼ï¼š

```powershell
# æ£€æŸ¥å®¹å™¨æ¨¡å¼
docker version

# åˆ‡æ¢åˆ° Linux å®¹å™¨ (å¦‚æœéœ€è¦)
# Docker Desktop > Settings > General
```

#### ğŸ“± ç½‘ç»œè¿æ¥é—®é¢˜

å¦‚æœé‡åˆ°ç½‘ç»œè¶…æ—¶ï¼š

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://hub.docker.com

# ä½¿ç”¨ä»£ç† (å¦‚æœå…¬å¸ç½‘ç»œéœ€è¦)
export HTTP_PROXY=http://proxy.company.com:8080
./push-to-dockerhub.sh --all
```

### ğŸ“š è¿ç§»æŒ‡å—

#### ğŸ“ˆ ä» GCC è¿ç§»

æ—§ç‰ˆæœ¬ä½¿ç”¨äº† GCCï¼Œæ–°ç‰ˆæœ¬è‡ªåŠ¨ä½¿ç”¨ Clangï¼š

```diff
# æ—§ç‰ˆæœ¬ (åœ¨å®¹å™¨å†…å®‰è£… gcc)
- apt-get install -y gcc g++
- gcc/g++ main.cpp -o main

# æ–°ç‰ˆæœ¬ (é¢„è£… Clang)
+ clang++ main.cpp -o main  # æ— éœ€å®‰è£…
+ clang --version           # éªŒè¯å®‰è£…
```

#### ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

- âœ… **å‘åå…¼å®¹**: ä»ç„¶æ”¯æŒ `c++17`, `c11` ç­‰æ ‡å‡†
- âœ… **è¯­æ³•å…¼å®¹**: Clang å®Œå…¨å…¼å®¹ GCC è¯­æ³•
- âœ… **åº“å…¼å®¹**: libc++ å’Œ libstdc++ å…¼å®¹
- âœ… **æ‰©å±•æ”¯æŒ**: Clang ç‰¹å®šçš„æ‰©å±•æ”¯æŒ

### ğŸ”— å®Œæ•´é›†æˆ

#### ğŸ“‹ æ¨èçš„å®Œæ•´æµç¨‹

1. **å¼€å‘é˜¶æ®µ**: æœ¬åœ°ä½¿ç”¨è‡ªåŠ¨æ‹‰å–çš„é•œåƒ
2. **æµ‹è¯•é˜¶æ®µ**: GitHub Actions è‡ªåŠ¨æµ‹è¯•
3. **å‘å¸ƒé˜¶æ®µ**: è‡ªåŠ¨æ„å»ºå¹¶æ¨é€æ–°ç‰ˆæœ¬
4. **ä½¿ç”¨é˜¶æ®µ**: OI-Code æ‰©å±•æ— ç¼ä½¿ç”¨æ–°é•œåƒ

#### ğŸŒŸ é¡¹ç›®é“¾æ¥

- ğŸ”— **GitHub ä»“åº“**: https://github.com/FlowerRealm/oi-code-extension
- ğŸ³ **Docker Hub**: https://hub.docker.com/r/flowerrealm/oi-code-clang
- ğŸ“– **VS Code æ‰©å±•**: [OI-Code in VS Code Marketplace]

### ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0.0**: åˆå§‹ Clang 18 è‡ªåŠ¨å‘å¸ƒ
  - Ubuntu 24.04 LTS åŸºç¡€
  - å®Œæ•´çš„ LLVM/Clang å·¥å…·é“¾
  - GitHub Actions CI/CD é›†æˆ
  - æ„å»ºç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–
  - è·¨å¹³å°å…¼å®¹æ€§æ”¹è¿›

### Custom Image Details

#### Linux Image (`oi-code-clang:latest`)
- **Base**: Ubuntu 24.04
- **Tools Installed**:
  - Clang/Clang++
  - libc++ (C++ standard library)
  - LLVM toolchain
  - lldb debugger
  - lld linker
  - Development tools (valgrind)

### Troubleshooting

#### Image Build Fails
If custom image building fails, you can configure OI-Code to fall back to official images:

In VS Code settings, add:
```json
"oicode.docker.compilers": {
  "cpp": "ubuntu:24.04",
  "c": "ubuntu:24.04"
}
```

#### Linux: Clang Not Found
Install Clang in the container:
```bash
apt-get update && apt-get install -y clang clang++
```

#### Windows: Setup Challenges
For Windows containers with Clang:
1. Download LLVM/Clang distribution from https://releases.llvm.org/
2. Extract binaries to `C:\llvm\bin\`
3. Add to PATH: `ENV PATH="C:\llvm\bin;%PATH%"`
4. Update Dockerfile.windows with actual paths

### Advanced Usage

#### Manual Image Building

```bash
# Build Linux image manually
docker build -t oi-code-clang:latest -f Dockerfile .
```

#### Custom Compiler Configuration
You can override the default images in VS Code settings:

```json
{
  "oicode.docker.compilers": {
    "cpp": "my-custom-gcc:latest",
    "c": "my-custom-gcc:latest"
  }
}
```

#### Image Registry
Push your custom images to a registry for team sharing:

```bash
# Tag and push to registry
docker tag oi-code-clang:latest my-registry.com/oi-code-clang:latest
docker push my-registry.com/oi-code-clang:latest
```

### Performance Considerations

- **Container Pool**: Custom images work with the container pool optimization
- **Cache Mounting**: Enabled for better file synchronization performance
- **Image Size**: Ubuntu-based image is ~1GB, Nano Server image is ~300MB

### Known Limitations

1. **Windows Support**: Windows Nano Server doesn't support direct package installation
2. **Large Binaries**: Clang toolchain significantly increases image size
3. **Cross-platform**: Windows containers cannot run on Linux hosts directly

### Migration from GCC

The extension automatically detects and uses the new Clang images. No manual configuration is required after building the images.

Previous GCC-based configurations will still work if you don't build the new images.
